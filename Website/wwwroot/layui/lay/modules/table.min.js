/**
 @Name：layui.table 表格操作
 @Author：贤心
 @License：MIT
    
 */
layui.define(["laytpl","laypage","layer","form","util"],function(n){"use strict";var t=layui.$,o=layui.laytpl,rt=layui.laypage,e=layui.layer,d=layui.form,pt=layui.util,h=layui.hint(),a=layui.device(),i={config:{checkName:"LAY_CHECKED",indexName:"LAY_TABLE_INDEX"},cache:{},index:layui.table?layui.table.index+1e4:0,set:function(n){var i=this;return i.config=t.extend({},i.config,n),i},on:function(n,t){return layui.onevent.call(this,f,n,t)}},u=function(){var n=this,t=n.config,i=t.id||t.index;return i&&(u.that[i]=n,u.config[i]=t),{reload:function(t){n.reload.call(n,t)},setColsWidth:function(){n.setColsWidth.call(n)},resize:function(){n.resize.call(n)},config:t}},g=function(n){var t=u.config[n];return t||h.error("The ID option was not found in the table instance"),t||null},f="table",ut=".layui-table",s="layui-hide",c="layui-none",nt="layui-table-view",ft=".layui-table-tool",et=".layui-table-box",ot=".layui-table-init",tt=".layui-table-header",p=".layui-table-body",st=".layui-table-main",ht=".layui-table-fixed",ct=".layui-table-fixed-l",lt=".layui-table-fixed-r",at=".layui-table-total",vt=".layui-table-page",v=".layui-table-sort",y="layui-table-edit",it="layui-table-hover",w=function(n){return n=n||{},['<table cellspacing="0" cellpadding="0" border="0" class="layui-table" ','{{# if(d.data.skin){ }}lay-skin="{{d.data.skin}}"{{# } }} {{# if(d.data.size){ }}lay-size="{{d.data.size}}"{{# } }} {{# if(d.data.even){ }}lay-even{{# } }}>',"<thead>","{{# layui.each(d.data.cols, function(i1, item1){ }}","<tr>","{{# layui.each(item1, function(i2, item2){ }}",'{{# if(item2.fixed && item2.fixed !== "right"){ left = true; } }}','{{# if(item2.fixed === "right"){ right = true; } }}',function(){return n.fixed&&n.fixed!=="right"?'{{# if(item2.fixed && item2.fixed !== "right"){ }}':n.fixed==="right"?'{{# if(item2.fixed === "right"){ }}':""}(),"{{# var isSort = !(item2.colGroup) && item2.sort; }}",'<th data-field="{{ item2.field||i2 }}" data-key="{{d.index}}-{{i1}}-{{i2}}" {{# if( item2.parentKey){ }}data-parentkey="{{ item2.parentKey }}"{{# } }} {{# if(item2.minWidth){ }}data-minwidth="{{item2.minWidth}}"{{# } }} {{#if(item2.colspan){}} colspan="{{item2.colspan}}"{{#} if(item2.rowspan){}} rowspan="{{item2.rowspan}}"{{#}}} {{# if(item2.unresize || item2.colGroup){ }}data-unresize="true"{{# } }} class="{{# if(item2.hide){ }}layui-hide{{# } }}{{# if(isSort){ }} layui-unselect{{# } }}{{# if(!item2.field){ }} layui-table-col-special{{# } }}">','<div class="layui-table-cell laytable-cell-',"{{# if(item2.colGroup){ }}","group","{{# } else { }}","{{d.index}}-{{i1}}-{{i2}}",'{{# if(item2.type !== "normal"){ }}'," laytable-cell-{{ item2.type }}","{{# } }}","{{# } }}",'" {{#if(item2.align){}}align="{{item2.align}}"{{#}}}>','{{# if(item2.type === "checkbox"){ }}','<input type="checkbox" name="layTableCheckbox" lay-skin="primary" lay-filter="layTableAllChoose" {{# if(item2[d.data.checkName]){ }}checked{{# }; }}>',"{{# } else { }}",'<span>{{item2.title||""}}<\/span>',"{{# if(isSort){ }}",'<span class="layui-table-sort layui-inline"><i class="layui-edge layui-table-sort-asc" title="升序"><\/i><i class="layui-edge layui-table-sort-desc" title="降序"><\/i><\/span>',"{{# } }}","{{# } }}","<\/div>","<\/th>",n.fixed?"{{# }; }}":"","{{# }); }}","<\/tr>","{{# }); }}","<\/thead>","<\/table>"].join("")},b='<table cellspacing="0" cellpadding="0" border="0" class="layui-table" {{# if(d.data.skin){ }}lay-skin="{{d.data.skin}}"{{# } }} {{# if(d.data.size){ }}lay-size="{{d.data.size}}"{{# } }} {{# if(d.data.even){ }}lay-even{{# } }}><tbody><\/tbody><\/table>',yt=['<div class="layui-form layui-border-box {{d.VIEW_CLASS}}" lay-filter="LAY-table-{{d.index}}" lay-id="{{ d.data.id }}" style="{{# if(d.data.width){ }}width:{{d.data.width}}px;{{# } }} {{# if(d.data.height){ }}height:{{d.data.height}}px;{{# } }}">',"{{# if(d.data.toolbar){ }}",'<div class="layui-table-tool">','<div class="layui-table-tool-temp"><\/div>','<div class="layui-table-tool-self"><\/div>',"<\/div>","{{# } }}",'<div class="layui-table-box">',"{{# if(d.data.loading){ }}",'<div class="layui-table-init" style="background-color: #fff;">','<i class="layui-icon layui-icon-loading layui-icon"><\/i>',"<\/div>","{{# } }}","{{# var left, right; }}",'<div class="layui-table-header">',w(),"<\/div>",'<div class="layui-table-body layui-table-main">',b,"<\/div>","{{# if(left){ }}",'<div class="layui-table-fixed layui-table-fixed-l">','<div class="layui-table-header">',w({fixed:!0}),"<\/div>",'<div class="layui-table-body">',b,"<\/div>","<\/div>","{{# }; }}","{{# if(right){ }}",'<div class="layui-table-fixed layui-table-fixed-r">','<div class="layui-table-header">',w({fixed:"right"}),'<div class="layui-table-mend"><\/div>',"<\/div>",'<div class="layui-table-body">',b,"<\/div>","<\/div>","{{# }; }}","<\/div>","{{# if(d.data.totalRow){ }}",'<div class="layui-table-total">','<table cellspacing="0" cellpadding="0" border="0" class="layui-table" ','{{# if(d.data.skin){ }}lay-skin="{{d.data.skin}}"{{# } }} {{# if(d.data.size){ }}lay-size="{{d.data.size}}"{{# } }} {{# if(d.data.even){ }}lay-even{{# } }}>','<tbody><tr><td><div class="layui-table-cell" style="visibility: hidden;">Total<\/div><\/td><\/tr><\/tbody>',"<\/table>","<\/div>","{{# } }}","{{# if(d.data.page){ }}",'<div class="layui-table-page">','<div id="layui-table-page{{d.index}}"><\/div>',"<\/div>","{{# } }}","<style>","{{# layui.each(d.data.cols, function(i1, item1){","layui.each(item1, function(i2, item2){ }}",".laytable-cell-{{d.index}}-{{i1}}-{{i2}}{ ","{{# if(item2.width){ }}","width: {{item2.width}}px;","{{# } }}"," }","{{# });","}); }}","<\/style>","<\/div>"].join(""),k=t(window),l=t(document),r=function(n){var r=this;r.index=++i.index;r.config=t.extend({},r.config,i.config,n);r.render()};r.prototype.config={limit:10,loading:!0,cellMinWidth:60,defaultToolbar:["filter","exports","print"],autoSort:!0,text:{none:"无数据"}};r.prototype.render=function(){var i=this,n=i.config,u;if(n.elem=t(n.elem),n.where=n.where||{},n.id=n.id||n.elem.attr("id")||i.index,n.request=t.extend({pageName:"page",limitName:"limit"},n.request),n.response=t.extend({statusName:"code",statusCode:0,msgName:"msg",dataName:"data",countName:"count"},n.response),typeof n.page=="object"&&(n.limit=n.page.limit||n.limit,n.limits=n.page.limits||n.limits,i.page=n.page.curr=n.page.curr||1,delete n.page.elem,delete n.page.jump),!n.elem[0])return i;n.height&&/^full-\d+$/.test(n.height)&&(i.fullHeightGap=n.height.split("-")[1],n.height=k.height()-i.fullHeightGap);i.setInit();var f=n.elem,e=f.next("."+nt),r=i.elem=t(o(yt).render({VIEW_CLASS:nt,data:n,index:i.index}));n.index=i.index;e[0]&&e.remove();f.after(r);i.layTool=r.find(ft);i.layBox=r.find(et);i.layHeader=r.find(tt);i.layMain=r.find(st);i.layBody=r.find(p);i.layFixed=r.find(ht);i.layFixLeft=r.find(ct);i.layFixRight=r.find(lt);i.layTotal=r.find(at);i.layPage=r.find(vt);i.renderToolbar();i.fullSize();n.cols.length>1&&(u=i.layFixed.find(tt).find("th"),u.height(i.layHeader.height()-1-parseFloat(u.css("padding-top"))-parseFloat(u.css("padding-bottom"))));i.pullData(i.page);i.events()};r.prototype.initOpts=function(n){var t=this,i=t.config;n.checkbox&&(n.type="checkbox");n.space&&(n.type="space");n.type||(n.type="normal");n.type!=="normal"&&(n.unresize=!0,n.width=n.width||{checkbox:48,radio:48,space:15,numbers:40}[n.type])};r.prototype.setInit=function(n){var i=this,t=i.config;if(t.clientWidth=t.width||function(){var n=function(i){var r,u;i=i||t.elem.parent();r=i.width();try{u=i.css("display")==="none"}catch(f){}return i[0]&&(!r||u)?n(i.parent()):r};return n()}(),n==="width")return t.clientWidth;layui.each(t.cols,function(n,r){layui.each(r,function(u,f){if(!f){r.splice(u,1);return}if(f.key=n+"-"+u,f.hide=f.hide||!1,f.colGroup||f.colspan>1){var e=0;layui.each(t.cols[n+1],function(t,i){i.HAS_PARENT||e>1&&e==f.colspan||(i.HAS_PARENT=!0,i.parentKey=n+"-"+u,e=e+parseInt(i.colspan>1?i.colspan:1))});f.colGroup=!0}i.initOpts(f)})})};r.prototype.renderToolbar=function(){var i=this,n=i.config,s='<div class="layui-inline" lay-event="add"><i class="layui-icon layui-icon-add-1"><\/i><\/div><div class="layui-inline" lay-event="update"><i class="layui-icon layui-icon-edit"><\/i><\/div><div class="layui-inline" lay-event="delete"><i class="layui-icon layui-icon-delete"><\/i><\/div>',f=i.layTool.find(".layui-table-tool-temp"),r,e,u;n.toolbar==="default"?f.html(s):typeof n.toolbar=="string"&&(r=t(n.toolbar).html()||"",r&&f.html(o(r).render(n)));e={filter:{title:"筛选列",layEvent:"LAYTABLE_COLS",icon:"layui-icon-cols"},exports:{title:"导出",layEvent:"LAYTABLE_EXPORT",icon:"layui-icon-export"},print:{title:"打印",layEvent:"LAYTABLE_PRINT",icon:"layui-icon-print"}};u=[];typeof n.defaultToolbar=="object"&&layui.each(n.defaultToolbar,function(n,t){var i=e[t];i&&u.push('<div class="layui-inline" title="'+i.title+'" lay-event="'+i.layEvent+'"><i class="layui-icon '+i.icon+'"><\/i><\/div>')});i.layTool.find(".layui-table-tool-self").html(u.join(""))};r.prototype.setParentCol=function(n,t){var u=this,h=u.config,r=u.layHeader.find('th[data-key="'+h.index+"-"+t+'"]'),i=parseInt(r.attr("colspan"))||0,f,e,o;r[0]&&(f=t.split("-"),e=h.cols[f[0]][f[1]],n?i--:i++,r.attr("colspan",i),r[i<1?"addClass":"removeClass"](s),e.colspan=i,e.hide=i<1,o=r.data("parentkey"),o&&u.setParentCol(n,o))};r.prototype.setColsPatch=function(){var n=this,t=n.config;layui.each(t.cols,function(t,i){layui.each(i,function(t,i){i.hide&&n.setParentCol(i.hide,i.parentKey)})})};r.prototype.setColsWidth=function(){var n=this,t=n.config,f=0,r=0,u=0,e=0,i=n.setInit("width"),s,o;if(n.eachCols(function(n,t){t.hide||f++}),i=i-function(){return t.skin==="line"||t.skin==="nob"?2:f+1}()-n.getScrollWidth(n.layMain[0])-1,s=function(n){layui.each(t.cols,function(f,o){layui.each(o,function(f,s){var h=0,c=s.minWidth||t.cellMinWidth;if(!s){o.splice(f,1);return}s.colGroup||s.hide||(n?u&&u<c&&(r--,h=c):(h=s.width||0,/\d+%$/.test(h)?(h=Math.floor(parseFloat(h)/100*i),h<c&&(h=c)):h||(s.width=h=0,r++)),s.hide&&(h=0),e=e+h)})});i>e&&r&&(u=(i-e)/r)},s(),s(!0),n.autoColNums=r,n.eachCols(function(r,f){var e=f.minWidth||t.cellMinWidth;f.colGroup||f.hide||(f.width===0?n.getCssRule(t.index+"-"+f.key,function(n){n.style.width=Math.floor(u>=e?u:e)+"px"}):/\d+%$/.test(f.width)&&n.getCssRule(t.index+"-"+f.key,function(n){n.style.width=Math.floor(parseFloat(f.width)/100*i)+"px"}))}),o=n.layMain.width()-n.getScrollWidth(n.layMain[0])-n.layMain.children("table").outerWidth(),n.autoColNums&&o>=-f&&o<=f){var h=function(t){var i;return(t=t||n.layHeader.eq(0).find("thead th:last-child"),i=t.data("field"),!i&&t.prev()[0])?h(t.prev()):t},c=h(),l=c.data("key");n.getCssRule(l,function(t){var i=t.style.width||c.outerWidth();t.style.width=parseFloat(i)+o+"px";n.layMain.height()-n.layMain.prop("clientHeight")>0&&(t.style.width=parseFloat(t.style.width)-1+"px")})}n.loading(!0)};r.prototype.resize=function(){var n=this;n.fullSize();n.setColsWidth();n.scrollPatch()};r.prototype.reload=function(n){var i=this;i.config.data&&i.config.data.constructor===Array&&delete i.config.data;i.config=t.extend({},i.config,n);i.render()};r.prototype.page=1;r.prototype.pullData=function(n){var r=this,i=r.config,s=i.request,u=i.response,h=function(){typeof i.initSort=="object"&&r.sort(i.initSort.field,i.initSort.type)},e,o,f,l;r.startTime=(new Date).getTime();i.url?(e={},e[s.pageName]=n,e[s.limitName]=i.limit,o=t.extend(e,i.where),i.contentType&&i.contentType.indexOf("application/json")==0&&(o=JSON.stringify(o)),t.ajax({type:i.method||"get",url:i.url,contentType:i.contentType,data:o,dataType:"json",headers:i.headers||{},success:function(t){typeof i.parseData=="function"&&(t=i.parseData(t)||t);t[u.statusName]!=u.statusCode?(r.renderForm(),r.layMain.html('<div class="'+c+'">'+(t[u.msgName]||"返回的数据不符合规范，正确的成功状态码 ("+u.statusName+") 应为："+u.statusCode)+"<\/div>")):(r.renderData(t,n,t[u.countName]),h(),i.time=(new Date).getTime()-r.startTime+" ms");r.setColsWidth();typeof i.done=="function"&&i.done(t,n,t[u.countName])},error:function(n,t){r.layMain.html('<div class="'+c+'">数据接口请求异常：'+t+"<\/div>");r.renderForm();r.setColsWidth()}})):i.data&&i.data.constructor===Array&&(f={},l=n*i.limit-i.limit,f[u.dataName]=i.data.concat().splice(l,i.limit),f[u.countName]=i.data.length,r.renderData(f,n,i.data.length),h(),r.setColsWidth(),typeof i.done=="function"&&i.done(f,n,f[u.countName]))};r.prototype.eachCols=function(n){var t=this;return i.eachCols(null,n,t.config.cols),t};r.prototype.renderData=function(n,r,u,f){var h=this,l=h.config,a=n[l.response.dataName]||[],v=[],y=[],p=[],w=function(){var n;if(!f&&h.sortKey)return h.sort(h.sortKey.field,h.sortKey.sort,!0);layui.each(a,function(u,e){var c=[],a=[],w=[],b=u+l.limit*(r-1)+1;e.length!==0&&(f||(e[i.config.indexName]=u),h.eachCols(function(r,f){var p=f.field||r,y=l.index+"-"+f.key,h=e[p],v;((h===undefined||h===null)&&(h=""),f.colGroup)||(v=['<td data-field="'+p+'" data-key="'+y+'" '+function(){var n=[];return f.edit&&n.push('data-edit="'+f.edit+'"'),f.align&&n.push('align="'+f.align+'"'),f.templet&&n.push('data-content="'+h+'"'),f.toolbar&&n.push('data-off="true"'),f.event&&n.push('lay-event="'+f.event+'"'),f.style&&n.push('style="'+f.style+'"'),f.minWidth&&n.push('data-minwidth="'+f.minWidth+'"'),n.join(" ")}()+' class="'+function(){var n=[];return f.hide&&n.push(s),f.field||n.push("layui-table-col-special"),n.join(" ")}()+'">','<div class="layui-table-cell laytable-cell-'+function(){return f.type==="normal"?y:y+" laytable-cell-"+f.type}()+'">'+function(){var s=t.extend(!0,{LAY_INDEX:b},e),r=i.config.checkName;switch(f.type){case"checkbox":return'<input type="checkbox" name="layTableCheckbox" lay-skin="primary" '+function(){return f[r]?(e[r]=f[r],f[r]?"checked":""):s[r]?"checked":""}()+">";case"radio":return s[r]&&(n=u),'<input type="radio" name="layTableRadio_'+l.index+'" '+(s[r]?"checked":"")+' lay-type="layTableRadio">';case"numbers":return b}return f.toolbar?o(t(f.toolbar).html()||"").render(s):f.templet?function(){return typeof f.templet=="function"?f.templet(s):o(t(f.templet).html()||String(h)).render(s)}():h}(),"<\/div><\/td>"].join(""),c.push(v),f.fixed&&f.fixed!=="right"&&a.push(v),f.fixed==="right"&&w.push(v))}),v.push('<tr data-index="'+u+'">'+c.join("")+"<\/tr>"),y.push('<tr data-index="'+u+'">'+a.join("")+"<\/tr>"),p.push('<tr data-index="'+u+'">'+w.join("")+"<\/tr>"))});h.layBody.scrollTop(0);h.layMain.find("."+c).remove();h.layMain.find("tbody").html(v.join(""));h.layFixLeft.find("tbody").html(y.join(""));h.layFixRight.find("tbody").html(p.join(""));h.renderForm();typeof n=="number"&&h.setThisRowChecked(n);h.syncCheckAll();h.haveInit?h.scrollPatch():setTimeout(function(){h.scrollPatch()},50);h.haveInit=!0;e.close(h.tipsIndex);l.HAS_SET_COLS_PATCH||h.setColsPatch();l.HAS_SET_COLS_PATCH=!0};if(h.key=l.id||l.index,i.cache[h.key]=a,h.layPage[u==0||a.length===0&&r==1?"addClass":"removeClass"](s),f)return w();if(a.length===0)return h.renderForm(),h.layFixed.remove(),h.layMain.find("tbody").html(""),h.layMain.find("."+c).remove(),h.layMain.append('<div class="'+c+'">'+l.text.none+"<\/div>");w();h.renderTotal(a);l.page&&(l.page=t.extend({elem:"layui-table-page"+l.index,count:u,limit:l.limit,limits:l.limits||[10,20,30,40,50,60,70,80,90],groups:3,layout:["prev","page","next","skip","count","limit"],prev:'<i class="layui-icon">&#xe603;<\/i>',next:'<i class="layui-icon">&#xe602;<\/i>',jump:function(n,t){t||(h.page=n.curr,l.limit=n.limit,h.loading(),h.pullData(n.curr))}},l.page),l.page.count=u,rt.render(l.page))};r.prototype.renderTotal=function(n){var t=this,i=t.config,r={},u;i.totalRow&&(layui.each(n,function(n,i){i.length!==0&&t.eachCols(function(n,t){var u=t.field||n,f=i[u];t.totalRow&&(r[u]=(r[u]||0)+(parseFloat(f)||0))})}),u=[],t.eachCols(function(n,t){var f=t.field||n,e=['<td data-field="'+f+'" data-key="'+i.index+"-"+t.key+'" '+function(){var n=[];return t.align&&n.push('align="'+t.align+'"'),t.style&&n.push('style="'+t.style+'"'),t.minWidth&&n.push('data-minwidth="'+t.minWidth+'"'),n.join(" ")}()+' class="'+function(){var n=[];return t.hide&&n.push(s),t.field||n.push("layui-table-col-special"),n.join(" ")}()+'">','<div class="layui-table-cell laytable-cell-'+function(){var n=i.index+"-"+t.key;return t.type==="normal"?n:n+" laytable-cell-"+t.type}()+'">'+function(){var n=t.totalRowText||"";return t.totalRow?parseFloat(r[f]).toFixed(2)||n:n}(),"<\/div><\/td>"].join("");u.push(e)}),t.layTotal.find("tbody").html("<tr>"+u.join("")+"<\/tr>"))};r.prototype.getColElem=function(n,t){var i=this,r=i.config;return n.eq(0).find(".laytable-cell-"+(r.index+"-"+t)+":eq(0)")};r.prototype.renderForm=function(n){d.render(n,"LAY-table-"+this.index)};r.prototype.setThisRowChecked=function(n){var t=this,u=t.config,i="layui-table-click",r=t.layBody.find('tr[data-index="'+n+'"]');r.addClass(i).siblings("tr").removeClass(i)};r.prototype.sort=function(n,r,u,e){var o=this,y={},a=o.config,b=a.elem.attr("lay-filter"),c=i.cache[o.key],l,s,p,w;typeof n=="string"&&o.layHeader.find("th").each(function(){var i=t(this),r=i.data("field");if(r===n)return n=i,s=r,!1});try{if(s=s||n.data("field"),p=n.data("key"),o.sortKey&&!u&&s===o.sortKey.field&&r===o.sortKey.sort)return;w=o.layHeader.find("th .laytable-cell-"+p).find(v);o.layHeader.find("th").find(v).removeAttr("lay-sort");w.attr("lay-sort",r||null);o.layFixed.find("th")}catch(k){return h.error("Table modules: Did not match to field")}o.sortKey={field:s,sort:r};a.autoSort&&(r==="asc"?l=layui.sort(c,s):r==="desc"?l=layui.sort(c,s,!0):(l=layui.sort(c,i.config.indexName),delete o.sortKey));y[a.response.dataName]=l||c;o.renderData(y,o.page,o.count,!0);e&&layui.event.call(n,f,"sort("+b+")",{field:s,type:r})};r.prototype.loading=function(n){var i=this,r=i.config;r.loading&&(n?(i.layInit&&i.layInit.remove(),delete i.layInit,i.layBox.find(ot).remove()):(i.layInit=t('<div class="layui-table-init"><i class="layui-icon layui-icon-loading layui-icon"><\/i><\/div>'),i.layBox.append(i.layInit)))};r.prototype.setCheckData=function(n,t){var u=this,f=u.config,r=i.cache[u.key];r[n]&&r[n].constructor!==Array&&(r[n][f.checkName]=t)};r.prototype.syncCheckAll=function(){var n=this,u=n.config,t=n.layHeader.find('input[name="layTableCheckbox"]'),r=function(t){return n.eachCols(function(n,i){i.type==="checkbox"&&(i[u.checkName]=t)}),t};t[0]&&(i.checkStatus(n.key).isAll?(t[0].checked||(t.prop("checked",!0),n.renderForm("checkbox")),r(!0)):(t[0].checked&&(t.prop("checked",!1),n.renderForm("checkbox")),r(!1)))};r.prototype.getCssRule=function(n,t){var u=this,i=u.elem.find("style")[0],r=i.sheet||i.styleSheet||{},f=r.cssRules||r.rules;layui.each(f,function(i,r){if(r.selectorText===".laytable-cell-"+n)return t(r),!0})};r.prototype.fullSize=function(){var n=this,r=n.config,i=r.height,t;(n.fullHeightGap&&(i=k.height()-n.fullHeightGap,i<135&&(i=135),n.elem.css("height",i)),i)&&(t=parseFloat(i)-(n.layHeader.is(":visible")?n.layHeader.outerHeight():38),r.toolbar&&(t=t-(n.layTool.is(":visible")?n.layTool.outerHeight():50)),r.totalRow&&(t=t-(n.layTotal.is(":visible")?n.layTotal.outerHeight():40)),r.page&&(t=t-(n.layPage.is(":visible")?n.layPage.outerHeight():41)-2),n.layMain.css("height",t))};r.prototype.getScrollWidth=function(n){var t=0;return n?t=n.offsetWidth-n.clientWidth:(n=document.createElement("div"),n.style.width="100px",n.style.height="100px",n.style.overflowY="scroll",document.body.appendChild(n),t=n.offsetWidth-n.clientWidth,document.body.removeChild(n)),t};r.prototype.scrollPatch=function(){var n=this,u=n.layMain.children("table"),i=n.layMain.width()-n.layMain.prop("clientWidth"),f=n.layMain.height()-n.layMain.prop("clientHeight"),c=n.getScrollWidth(n.layMain[0]),h=u.outerWidth()-n.layMain.width(),e=function(n){if(i&&f){if(n=n.eq(0),!n.find(".layui-table-patch")[0]){var r=t('<th class="layui-table-patch"><div class="layui-table-cell"><\/div><\/th>');r.find("div").css({width:i});n.find("tr").append(r)}}else n.find(".layui-table-patch").remove()},o,r;e(n.layHeader);e(n.layTotal);o=n.layMain.height();r=o-f;n.layFixed.find(p).css("height",u.height()>=r?r:"auto");n.layFixRight[h>0?"removeClass":"addClass"](s);n.layFixRight.css("right",i-1)};r.prototype.events=function(){var n=this,u=n.config,g=t("body"),r={},rt=n.layHeader.find("th"),w,b=".layui-table-cell",h=u.elem.attr("lay-filter"),c,nt;n.layTool.on("click","*[lay-event]",function(r){var v=t(this),y=v.attr("lay-event"),p=function(i){var f=t(i.list),r=t('<ul class="layui-table-tool-panel"><\/ul>');r.html(f);u.height&&r.css("max-height",u.height-(n.layTool.outerHeight()||50));v.find(".layui-table-tool-panel")[0]||v.append(r);n.renderForm();r.on("click",function(n){layui.stope(n)});i.done&&i.done(r,f)};layui.stope(r);l.trigger("table.tool.panel.remove");e.close(n.tipsIndex);switch(y){case"LAYTABLE_COLS":p({list:function(){var t=[];return n.eachCols(function(n,i){i.field&&i.type=="normal"&&t.push('<li><input type="checkbox" name="'+i.field+'" data-key="'+i.key+'" data-parentkey="'+(i.parentKey||"")+'" lay-skin="primary" '+(i.hide?"":"checked")+' title="'+(i.title||i.field)+'" lay-filter="LAY_TABLE_TOOL_COLS"><\/li>')}),t.join("")}(),done:function(){d.on("checkbox(LAY_TABLE_TOOL_COLS)",function(i){var f=t(i.elem),r=this.checked,e=f.data("key"),o=f.data("parentkey");layui.each(u.cols,function(t,i){layui.each(i,function(i,f){if(t+"-"+i===e){var h=f.hide;f.hide=!r;n.elem.find('*[data-key="'+u.index+"-"+e+'"]')[r?"removeClass":"addClass"](s);h!=f.hide&&n.setParentCol(!r,o);n.resize()}})})})}});break;case"LAYTABLE_EXPORT":a.ie?e.tips("导出功能不支持 IE，请用 Chrome 等高级浏览器导出",this,{tips:3}):p({list:function(){return'<li data-type="csv">导出到 Csv 文件<\/li><li data-type="xls">导出到 Excel 文件<\/li>'}(),done:function(n,r){r.on("click",function(){var n=t(this).data("type");i.exportFile(u.id,null,n)})}});break;case"LAYTABLE_PRINT":var o=window.open("打印窗口","_blank"),w="<style>body{font-size: 12px; color: #666;}table{width: 100%; border-collapse: collapse; border-spacing: 0;}th,td{line-height: 20px; padding: 9px 15px; border: 1px solid #ccc; text-align: left; font-size: 12px; color: #666;}a{color: #666; text-decoration:none;}*.layui-hide{display: none}<\/style>",c=t(n.layHeader.html());c.append(n.layMain.find("table").html());c.find("th.layui-table-patch").remove();c.find(".layui-table-col-special").remove();o.document.write(w+c.prop("outerHTML"));o.document.close();o.print();o.close()}layui.event.call(this,f,"toolbar("+h+")",t.extend({event:y,config:u},{}))});rt.on("mousemove",function(n){var i=t(this),u=i.offset().left,f=n.clientX-u;i.data("unresize")||r.resizeStart||(r.allowResize=i.width()-f<=10,g.css("cursor",r.allowResize?"col-resize":""))}).on("mouseleave",function(){var n=t(this);r.resizeStart||g.css("cursor","")}).on("mousedown",function(i){var f=t(this),e;r.allowResize&&(e=f.data("key"),i.preventDefault(),r.resizeStart=!0,r.offset=[i.clientX,i.clientY],n.getCssRule(e,function(n){var t=n.style.width||f.outerWidth();r.rule=n;r.ruleWidth=parseFloat(t);r.minWidth=f.data("minwidth")||u.cellMinWidth}))});l.on("mousemove",function(t){if(r.resizeStart){if(t.preventDefault(),r.rule){var i=r.ruleWidth+t.clientX-r.offset[0];i<r.minWidth&&(i=r.minWidth);r.rule.style.width=i+"px";e.close(n.tipsIndex)}w=1}}).on("mouseup",function(){r.resizeStart&&(r={},g.css("cursor",""),n.scrollPatch());w===2&&(w=null)});rt.on("click",function(){var i=t(this),r=i.find(v),u=r.attr("lay-sort"),f;if(!r[0]||w===1)return w=2;f=u==="asc"?"desc":u==="desc"?null:"asc";n.sort(i,f,null,!0)}).find(v+" .layui-edge ").on("click",function(i){var r=t(this),f=r.index(),u=r.parents("th").eq(0).data("field");layui.stope(i);f===0?n.sort(u,"asc",null,!0):n.sort(u,"desc",null,!0)});c=function(r){var s=t(this),f=s.parents("tr").eq(0).data("index"),e=n.layBody.find('tr[data-index="'+f+'"]'),u=i.cache[n.key][f];return t.extend({tr:e,data:i.clearCacheKey(u),del:function(){i.cache[n.key][f]=[];e.remove();n.scrollPatch()},update:function(i){i=i||{};layui.each(i,function(i,r){if(i in u){var f,s=e.children('td[data-field="'+i+'"]');u[i]=r;n.eachCols(function(n,t){t.field==i&&t.templet&&(f=t.templet)});s.children(b).html(function(){return f?function(){return typeof f=="function"?f(u):o(t(f).html()||r).render(u)}():r}());s.data("content",r)}})}},r)};n.elem.on("click",'input[name="layTableCheckbox"]+',function(){var i=t(this).prev(),e=n.layBody.find('input[name="layTableCheckbox"]'),o=i.parents("tr").eq(0).data("index"),r=i[0].checked,u=i.attr("lay-filter")==="layTableAllChoose";u?(e.each(function(t,i){i.checked=r;n.setCheckData(t,r)}),n.syncCheckAll(),n.renderForm("checkbox")):(n.setCheckData(o,r),n.syncCheckAll());layui.event.call(i[0],f,"checkbox("+h+")",c.call(i[0],{checked:r,type:u?"all":"one"}))});n.elem.on("click",'input[lay-type="layTableRadio"]+',function(){var r=t(this).prev(),e=r[0].checked,o=i.cache[n.key],u=r.parents("tr").eq(0).data("index");layui.each(o,function(n,t){u===n?t.LAY_CHECKED=!0:delete t.LAY_CHECKED});n.setThisRowChecked(u);layui.event.call(this,f,"radio("+h+")",c.call(this,{checked:e}))});n.layBody.on("mouseenter","tr",function(){var i=t(this),r=i.index();n.layBody.find("tr:eq("+r+")").addClass(it)}).on("mouseleave","tr",function(){var i=t(this),r=i.index();n.layBody.find("tr:eq("+r+")").removeClass(it)}).on("click","tr",function(){nt.call(this,"row")}).on("dblclick","tr",function(){nt.call(this,"rowDouble")});nt=function(n){var i=t(this);layui.event.call(this,f,n+"("+h+")",c.call(i.children("td")[0]))};n.layBody.on("change","."+y,function(){var r=t(this),u=this.value,e=r.parent().data("field"),o=r.parents("tr").eq(0).data("index"),s=i.cache[n.key][o];s[e]=u;layui.event.call(this,f,"edit("+h+")",c.call(this,{value:u,field:e}))}).on("blur","."+y,function(){var r,u=t(this),e=u.parent().data("field"),s=u.parents("tr").eq(0).data("index"),f=i.cache[n.key][s];n.eachCols(function(n,t){t.field==e&&t.templet&&(r=t.templet)});u.siblings(b).html(function(n){return r?function(){return typeof r=="function"?r(f):o(t(r).html()||this.value).render(f)}():n}(this.value));u.parent().data("content",this.value);u.remove()});n.layBody.on("click","td",function(n){var i=t(this),e=i.data("field"),u=i.data("edit"),f=i.children(b),r;if(!i.data("off")&&u){r=t('<input class="layui-input '+y+'">');r[0].value=i.data("content")||f.text();i.find("."+y)[0]||i.append(r);r.focus();layui.stope(n);return}}).on("mouseenter","td",function(){ut.call(this)}).on("mouseleave","td",function(){ut.call(this,"hide")});var tt="layui-table-grid-down",ut=function(n){var i=t(this),r=i.children(b);if(n)i.find(".layui-table-grid-down").remove();else if(r.prop("scrollWidth")>r.outerWidth()){if(r.find("."+tt)[0])return;i.append('<div class="'+tt+'"><i class="layui-icon layui-icon-down"><\/i><\/div>')}};n.layBody.on("click","."+tt,function(i){var f=t(this),o=f.parent(),r=o.children(b);n.tipsIndex=e.tips(['<div class="layui-table-tips-main" style="margin-top: -'+(r.height()+16)+"px;"+function(){return u.size==="sm"?"padding: 4px 15px; font-size: 12px;":u.size==="lg"?"padding: 14px 15px;":""}()+'">',r.html(),"<\/div>",'<i class="layui-icon layui-table-tips-c layui-icon-close"><\/i>'].join(""),r[0],{tips:[3,""],time:-1,anim:-1,maxWidth:a.ios||a.android?300:n.elem.width()/2,isOutAnim:!1,skin:"layui-table-tips",success:function(n,t){n.find(".layui-table-tips-c").on("click",function(){e.close(t)})}});layui.stope(i)});n.layBody.on("click","*[lay-event]",function(){var i=t(this),r=i.parents("tr").eq(0).data("index");layui.event.call(this,f,"tool("+h+")",c.call(this,{event:i.attr("lay-event")}));n.setThisRowChecked(r)});n.layMain.on("scroll",function(){var i=t(this),r=i.scrollLeft(),u=i.scrollTop();n.layHeader.scrollLeft(r);n.layTotal.scrollLeft(r);n.layFixed.find(p).scrollTop(u);e.close(n.tipsIndex)});l.on("click",function(){l.trigger("table.remove.tool.panel")});l.on("table.remove.tool.panel",function(){t(".layui-table-tool-panel").remove()});k.on("resize",function(){n.resize()})};i.init=function(n,r){r=r||{};var f=this,e=n?t('table[lay-filter="'+n+'"]'):t(ut+"[lay-data]"),u="Table element property lay-data configuration item has a syntax error: ";return e.each(function(){var f=t(this),o=f.attr("lay-data"),s,e;try{o=new Function("return "+o)()}catch(c){h.error(u+o)}s=[];e=t.extend({elem:this,cols:[],data:[],skin:f.attr("lay-skin"),size:f.attr("lay-size"),even:typeof f.attr("lay-even")=="string"},i.config,r,o);n&&f.hide();f.find("thead>tr").each(function(n){e.cols[n]=[];t(this).children().each(function(){var i=t(this),r=i.attr("lay-data"),f;try{r=new Function("return "+r)()}catch(o){return h.error(u+r)}f=t.extend({title:i.text(),colspan:i.attr("colspan")||0,rowspan:i.attr("rowspan")||0},r);f.colspan<2&&s.push(f);e.cols[n].push(f)})});f.find("tbody>tr").each(function(n){var r=t(this),i={};r.children("td").each(function(){var n=t(this),r=n.data("field");if(r)return i[r]=n.html()});layui.each(s,function(n,t){var u=r.children("td").eq(n);i[t.field]=u.html()});e.data[n]=i});i.render(e)}),f};u.that={};u.config={};i.eachCols=function(n,i,r){var s=u.config[n]||{},e=[],o=0,f;r=t.extend(!0,[],r||s.cols);layui.each(r,function(n,t){layui.each(t,function(t,i){if(i.colGroup){var u=0;o++;i.CHILD_COLS=[];layui.each(r[n+1],function(n,t){t.PARENT_COL_INDEX||u>1&&u==i.colspan||(t.PARENT_COL_INDEX=o,i.CHILD_COLS.push(t),u=u+parseInt(t.colspan>1?t.colspan:1))})}i.PARENT_COL_INDEX||e.push(i)})});f=function(n){layui.each(n||e,function(n,t){if(t.CHILD_COLS)return f(t.CHILD_COLS);typeof i=="function"&&i(n,t)})};f()};i.checkStatus=function(n){var r=0,u=0,f=[],t=i.cache[n]||[];return layui.each(t,function(n,t){if(t.constructor===Array){u++;return}t[i.config.checkName]&&(r++,f.push(i.clearCacheKey(t)))}),{data:f,isAll:t.length?r===t.length-u:!1}};i.exportFile=function(n,t,r){t=t||i.clearCacheKey(i.cache[n]);r=r||"csv";var e=u.config[n]||{},o={csv:"text/csv",xls:"application/vnd.ms-excel"}[r],f=document.createElement("a");if(a.ie)return h.error("IE_NOT_SUPPORT_EXPORTS");f.href="data:"+o+";charset=utf-8,﻿"+encodeURIComponent(function(){var r=[],u=[];return layui.each(t,function(t,f){var e=[];typeof n=="object"?(layui.each(n,function(n,i){t==0&&r.push(i||"")}),layui.each(i.clearCacheKey(f),function(n,t){e.push(t)})):i.eachCols(n,function(n,i){i.field&&i.type=="normal"&&!i.hide&&(t==0&&r.push(i.title||""),e.push(f[i.field]))});u.push(e.join(","))}),r.join(",")+"\r\n"+u.join("\r\n")}());f.download=(e.title||"table_"+(e.index||""))+"."+r;document.body.appendChild(f);f.click();document.body.removeChild(f)};i.resize=function(n){if(n){var t=g(n);if(!t)return;u.that[n].resize()}else layui.each(u.that,function(){this.resize()})};i.reload=function(n,r){r=r||{};var u=g(n);if(u)return r.data&&r.data.constructor===Array&&delete u.data,i.render(t.extend(!0,{},u,r))};i.render=function(n){var t=new r(n);return u.call(t)};i.clearCacheKey=function(n){return n=t.extend({},n),delete n[i.config.checkName],delete n[i.config.indexName],n};i.init();n(f,i)});