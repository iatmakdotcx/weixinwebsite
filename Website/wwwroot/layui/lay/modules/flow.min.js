/**
 @Name：layui.flow 流加载
 @Author：贤心
 @License：MIT
    
 */
layui.define("jquery",function(n){"use strict";var t=layui.$,i=function(){},r='<i class="layui-anim layui-anim-rotate layui-anim-loop layui-icon ">&#xe63e;<\/i>';i.prototype.load=function(n){var o=this,y=0,u,s,c,f,v,e,h;if(n=n||{},f=t(n.elem),f[0]){var p=t(n.scrollElem||document),w=n.mb||50,b="isAuto"in n?n.isAuto:!0,k=n.end||"没有更多了",l=n.scrollElem&&n.scrollElem!==document,a="<cite>加载更多<\/cite>",i=t('<div class="layui-flow-more"><a href="javascript:;">'+a+"<\/a><\/div>");f.find(".layui-flow-more")[0]||f.append(i);v=function(n,r){n=t(n);i.before(n);r=r==0?!0:null;r?i.html(k):i.find("a").html(a);s=r;u=null;h&&h()};e=function(){u=!0;i.find("a").html(r);typeof n.done=="function"&&n.done(++y,v)};e();i.find("a").on("click",function(){var n=t(this);s||u||e()});if(n.isLazyimg&&(h=o.lazyimg({elem:n.elem+" img",scrollElem:n.scrollElem})),!b)return o;p.on("scroll",function(){var n=t(this),i=n.scrollTop();(c&&clearTimeout(c),s)||(c=setTimeout(function(){var r=l?n.height():t(window).height(),f=l?n.prop("scrollHeight"):document.documentElement.scrollHeight;f-i-r<=w&&(u||e())},100))});return o}};i.prototype.lazyimg=function(n){var r=this,f=0,s,o;n=n||{};var i=t(n.scrollElem||document),c=n.elem||"img",e=n.scrollElem&&n.scrollElem!==document,h=function(n,t){var o=i.scrollTop(),c=o+t,h=e?function(){return n.offset().top-i.offset().top+o}():n.offset().top,s;h>=o&&h<=c&&(n.attr("src")||(s=n.attr("lay-src"),layui.img(s,function(){var t=r.lazyimg.elem.eq(f);n.attr("src",s).removeAttr("lay-src");t[0]&&u(t);f++})))},u=function(n,u){var l=e?(u||i).height():t(window).height(),a=i.scrollTop(),y=a+l,o,s,v;if(r.lazyimg.elem=t(c),n)h(n,l);else for(o=0;o<r.lazyimg.elem.length;o++)if(s=r.lazyimg.elem.eq(o),v=e?function(){return s.offset().top-i.offset().top+a}():s.offset().top,h(s,l),f=o,v>y)break};if(u(),!s){i.on("scroll",function(){var n=t(this);o&&clearTimeout(o);o=setTimeout(function(){u(null,n)},50)});s=!0}return u};n("flow",new i)});