/**
 @Name：layui.form 表单组件
 @Author：贤心
 @License：MIT
    
 */
layui.define("layer",function(n){"use strict";var t=layui.$,h=layui.layer,y=layui.hint(),c=layui.device(),u="form",f=".layui-form",i="layui-this",o="layui-hide",r="layui-disabled",e=function(){this.config={verify:{required:[/[\S]+/,"必填项不能为空"],phone:[/^1\d{10}$/,"请输入正确的手机号"],email:[/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/,"邮箱格式不正确"],url:[/(^#)|(^http(s*):\/\/[^\s]+\.[^\s]+)/,"链接格式不正确"],number:function(n){if(!n||isNaN(n))return"只能填写数字"},date:[/^(\d{4})[-\/](\d{1}|0\d{1}|1[0-2])([-\/](\d{1}|0\d{1}|[1-2][0-9]|3[0-1]))*$/,"日期格式不正确"],identity:[/(^\d{15}$)|(^\d{17}(x|X|\d)$)/,"请输入正确的身份证号"]}}};e.prototype.set=function(n){var i=this;return t.extend(!0,i.config,n),i};e.prototype.verify=function(n){var i=this;return t.extend(!0,i.config.verify,n),i};e.prototype.on=function(n,t){return layui.onevent.call(this,u,n,t)};e.prototype.val=function(n,i){var u=this,r=t(f+'[lay-filter="'+n+'"]');r.each(function(){var n=t(this);layui.each(i,function(t,i){var r=n.find('[name="'+t+'"]'),u;r[0]&&(u=r[0].type,u==="checkbox"?r[0].checked=i:u==="radio"?r.each(function(){this.value===i&&(this.checked=!0)}):r.val(i))})});s.render(null,n)};e.prototype.render=function(n,e){var c=this,s=t(f+function(){return e?'[lay-filter="'+e+'"]':""}()),h={select:function(){var h="请选择",n="layui-form-select",l="layui-select-title",e="layui-select-none",f="",c,y=s.find("select"),a=function(i,r){(!t(i.target).parent().hasClass(l)||r)&&(t("."+n).removeClass(n+"ed "+n+"up"),c&&f&&c.val(f));c=null},p=function(s,h,y){var k=t(this),nt=s.find("."+l),w=nt.find("input"),p=s.find("dl"),d=p.children("dd"),rt=this.selectedIndex,b,g,ft;if(!h){var ut=function(){var t=s.offset().top+s.outerHeight()+5-v.scrollTop(),r=p.outerHeight();rt=k[0].selectedIndex;s.addClass(n+"ed");d.removeClass(o);b=null;d.eq(rt).addClass(i).siblings().removeClass(i);t+r>v.height()&&t>=r&&s.addClass(n+"up");it()},tt=function(i){(s.removeClass(n+"ed "+n+"up"),w.blur(),b=null,i)||g(w.val(),function(n){var i=k[0].selectedIndex;n&&(f=t(k[0].options[i]).html(),i===0&&f===w.attr("placeholder")&&(f=""),w.val(f||""))})},it=function(){var t=p.children("dd."+i);if(t[0]){var n=t.position().top,r=p.height(),u=t.height();n>r&&p.scrollTop(n+p.scrollTop()-r+u-5);n<0&&p.scrollTop(n+p.scrollTop()-5)}};nt.on("click",function(t){s.hasClass(n+"ed")?tt():(a(t,!0),ut());p.find("."+e).remove()});nt.find(".layui-edge").on("click",function(){w.focus()});w.on("keyup",function(n){var t=n.keyCode;t===9&&ut()}).on("keydown",function(n){var t=n.keyCode,u;t===9&&tt();u=function(t,f){var e,h,s;if(n.preventDefault(),s=function(){var e=p.children("dd."+i),n,u;return p.children("dd."+o)[0]&&t==="next"&&(n=p.children("dd:not(."+o+",."+r+")"),u=n.eq(0).index(),u>=0&&u<e.index()&&!n.hasClass(i))?n.eq(0).prev()[0]?n.eq(0).prev():p.children(":last"):f&&f[0]?f:b&&b[0]?b:e}(),h=s[t](),e=s[t]("dd:not(."+o+")"),!h[0])return b=null;if(b=s[t](),(!e[0]||e.hasClass(r))&&b[0])return u(t,b);e.addClass(i).siblings().removeClass(i);it()};t===38&&u("prev");t===40&&u("next");t===13&&(n.preventDefault(),p.children("dd."+i).trigger("click"))});if(g=function(n,i,r){var f=0,u;return layui.each(d,function(){var i=t(this),u=i.text(),e=u.indexOf(n)===-1;(n===""||r==="blur"?n!==u:e)&&f++;r==="keyup"&&i[e?"addClass":"removeClass"](o)}),u=f===d.length,i(u),u},ft=function(n){var i=this.value,t=n.keyCode;if(t===9||t===13||t===37||t===38||t===39||t===40)return!1;g(i,function(n){n?p.find("."+e)[0]||p.append('<p class="'+e+'">无匹配项<\/p>'):p.find("."+e).remove()},"keyup");i===""&&p.find("."+e).remove();it()},y)w.on("keyup",ft).on("blur",function(){var n=k[0].selectedIndex;c=w;f=t(k[0].options[n]).html();n===0&&f===w.attr("placeholder")&&(f="");setTimeout(function(){g(w.val(),function(){f||w.val("")},"blur")},200)});d.on("click",function(){var n=t(this),f=n.attr("lay-value"),e=k.attr("lay-filter");return n.hasClass(r)?!1:(n.hasClass("layui-select-tips")?w.val(""):(w.val(n.text()),n.addClass(i)),n.siblings().removeClass(i),k.val(f).removeClass("layui-form-danger"),layui.event.call(this,u,"select("+e+")",{elem:k[0],value:f,othis:s}),tt(!0),!1)});s.find("dl>dt").on("click",function(){return!1});t(document).off("click",a).on("click",a)}};y.each(function(u,f){var e=t(this),a=e.next("."+n),s=this.disabled,v=f.value,w=t(f.options[f.selectedIndex]),c=f.options[0];if(typeof e.attr("lay-ignore")=="string")return e.show();var o=typeof e.attr("lay-search")=="string",b=c?c.value?h:c.innerHTML||h:h,y=t(['<div class="'+(o?"":"layui-unselect ")+n,(s?" layui-select-disabled":"")+'">','<div class="'+l+'">','<input type="text" placeholder="'+b+'" '+('value="'+(v?w.html():"")+'"')+(o?"":" readonly")+' class="layui-input'+(o?"":" layui-unselect")+(s?" "+r:"")+'">','<i class="layui-edge"><\/i><\/div>','<dl class="layui-anim layui-anim-upbit'+(e.find("optgroup")[0]?" layui-select-group":"")+'">',function(n){var t=[];return layui.each(n,function(n,u){n!==0||u.value?u.tagName.toLowerCase()==="optgroup"?t.push("<dt>"+u.label+"<\/dt>"):t.push('<dd lay-value="'+u.value+'" class="'+(v===u.value?i:"")+(u.disabled?" "+r:"")+'">'+u.innerHTML+"<\/dd>"):t.push('<dd lay-value="" class="layui-select-tips">'+(u.innerHTML||h)+"<\/dd>")}),t.length===0&&t.push('<dd lay-value="" class="'+r+'">没有选项<\/dd>'),t.join("")}(e.find("*"))+"<\/dl>","<\/div>"].join(""));a[0]&&a.remove();e.after(y);p.call(this,y,s,o)})},checkbox:function(){var n={checkbox:["layui-form-checkbox","layui-form-checked","checkbox"],_switch:["layui-form-switch","layui-form-onswitch","switch"]},i=s.find("input[type=checkbox]"),f=function(n,i){var r=t(this);n.on("click",function(){var f=r.attr("lay-filter"),t=(r.attr("lay-text")||"").split("|");r[0].disabled||(r[0].checked?(r[0].checked=!1,n.removeClass(i[1]).find("em").text(t[1])):(r[0].checked=!0,n.addClass(i[1]).find("em").text(t[0])),layui.event.call(r[0],u,i[2]+"("+f+")",{elem:r[0],value:r[0].value,othis:n}))})};i.each(function(i,u){var o=t(this),e=o.attr("lay-skin"),l=(o.attr("lay-text")||"").split("|"),a=this.disabled,s,h,c;if(e==="switch"&&(e="_"+e),s=n[e]||n.checkbox,typeof o.attr("lay-ignore")=="string")return o.show();h=o.next("."+s[0]);c=t(['<div class="layui-unselect '+s[0],u.checked?" "+s[1]:"",a?" layui-checkbox-disbaled "+r:"",'"',e?' lay-skin="'+e+'"':"",">",function(){var t=u.title.replace(/\s/g,""),n={checkbox:[t?"<span>"+u.title+"<\/span>":"",'<i class="layui-icon layui-icon-ok"><\/i>'].join(""),_switch:"<em>"+((u.checked?l[0]:l[1])||"")+"<\/em><i><\/i>"};return n[e]||n.checkbox}(),"<\/div>"].join(""));h[0]&&h.remove();o.after(c);f.call(this,c,s)})},radio:function(){var n="layui-form-radio",i=["&#xe643;","&#xe63f;"],e=s.find("input[type=radio]"),o=function(r){var e=t(this),o="layui-anim-scaleSpring";r.on("click",function(){var s=e[0].name,h=e.parents(f),c=e.attr("lay-filter"),l=h.find("input[name="+s.replace(/(\.|#|\[|\])/g,"\\$1")+"]");e[0].disabled||(layui.each(l,function(){var r=t(this).next("."+n);this.checked=!1;r.removeClass(n+"ed");r.find(".layui-icon").removeClass(o).html(i[1])}),e[0].checked=!0,r.addClass(n+"ed"),r.find(".layui-icon").addClass(o).html(i[0]),layui.event.call(e[0],u,"radio("+c+")",{elem:e[0],value:e[0].value,othis:r}))})};e.each(function(u,f){var e=t(this),h=e.next("."+n),c=this.disabled,s;if(typeof e.attr("lay-ignore")=="string")return e.show();h[0]&&h.remove();s=t(['<div class="layui-unselect '+n,f.checked?" "+n+"ed":"",(c?" layui-radio-disbaled "+r:"")+'">','<i class="layui-anim layui-icon">'+i[f.checked?0:1]+"<\/i>","<div>"+function(){var n=f.title||"";return typeof e.next().attr("lay-radio")=="string"&&(n=e.next().html(),e.next().remove()),n}()+"<\/div>","<\/div>"].join(""));e.after(s);o.call(this,s)})}};return n?h[n]?h[n]():y.error("不支持的"+n+"表单渲染"):layui.each(h,function(n,t){t()}),c};var l=function(){var e=t(this),n=s.config.verify,i=null,o="layui-form-danger",l={},a=e.parents(f),v=a.find("*[lay-verify]"),y=e.parents("form")[0],p=a.find("input,select,textarea"),w=e.attr("lay-filter"),r;return(layui.each(v,function(r,u){var f=t(this),l=f.attr("lay-verify").split("|"),e=f.attr("lay-verType"),s=f.val();return f.removeClass(o),layui.each(l,function(t,r){var l="",v=typeof n[r]=="function",a;if(n[r]&&(a=v?l=n[r](s,u):!n[r][0].test(s),l=l||n[r][1],a))return e==="tips"?h.tips(l,function(){return typeof f.attr("lay-ignore")!="string"&&(u.tagName.toLowerCase()==="select"||/^checkbox|radio$/.test(u.type))?f.next():f}(),{tips:1}):e==="alert"?h.alert(l,{title:"提示",shadeClose:!0}):h.msg(l,{icon:5,shift:6}),c.android||c.ios||u.focus(),f.addClass(o),i=!0}),i?i:void 0}),i)?!1:(r={},layui.each(p,function(n,t){if(t.name=(t.name||"").replace(/^\s*|\s*&/,""),t.name){if(/^.*\[\]$/.test(t.name)){var i=t.name.match(/^(.*)\[\]$/g)[0];r[i]=r[i]|0;t.name=t.name.replace(/^(.*)\[\]$/,"$1["+r[i]+++"]")}(!/^checkbox|radio$/.test(t.type)||t.checked)&&(l[t.name]=t.value)}}),layui.event.call(this,u,"submit("+w+")",{elem:this,form:y,field:l}))},s=new e,a=t(document),v=t(window);s.render();a.on("reset",f,function(){var n=t(this).attr("lay-filter");setTimeout(function(){s.render(null,n)},50)});a.on("submit",f,l).on("click","*[lay-submit]",l);n(u,s)});