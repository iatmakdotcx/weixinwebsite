/**
 @Title: layui.colorpicker 颜色选择器
 @Author: star1029
 @License：MIT
 */
layui.define("jquery",function(n){"use strict";var t=layui.jquery,a={config:{},index:layui.colorpicker?layui.colorpicker.index+1e4:0,set:function(n){var i=this;return i.config=t.extend({},i.config,n),i},on:function(n,t){return layui.onevent.call(this,"colorpicker",n,t)}},nt=function(){var n=this,t=n.config;return{config:t}},tt="layui-show",w="layui-colorpicker",r=".layui-colorpicker-main",s="layui-icon-down",h="layui-icon-close",u="layui-colorpicker-trigger-span",v="layui-colorpicker-trigger-i",it="layui-colorpicker-side",b="layui-colorpicker-side-slider",k="layui-colorpicker-basis",y="layui-colorpicker-alpha-bgcolor",c="layui-colorpicker-alpha-slider",d="layui-colorpicker-basis-cursor",f="layui-colorpicker-main-input",e=function(n){var t={h:0,s:0,b:0},u=Math.min(n.r,n.g,n.b),i=Math.max(n.r,n.g,n.b),r=i-u;return t.b=i,t.s=i!=0?255*r/i:0,t.h=t.s!=0?n.r==i?(n.g-n.b)/r:n.g==i?2+(n.b-n.r)/r:4+(n.r-n.g)/r:-1,i==u&&(t.h=0),t.h*=60,t.h<0&&(t.h+=360),t.s*=100/255,t.b*=100/255,t},rt=function(n){var n=n.indexOf("#")>-1?n.substring(1):n,t,i;return n.length==3&&(t=n.split(""),n=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),n=parseInt(n,16),i={r:n>>16,g:(n&65280)>>8,b:n&255},e(i)},g=function(n){var t={},u=n.h,o=n.s*255/100,e=n.b*255/100;if(o==0)t.r=t.g=t.b=e;else{var i=e,r=(255-o)*e/255,f=(i-r)*(u%60)/60;u==360&&(u=0);u<60?(t.r=i,t.b=r,t.g=r+f):u<120?(t.g=i,t.b=r,t.r=i-f):u<180?(t.g=i,t.r=r,t.b=r+f):u<240?(t.b=i,t.r=r,t.g=i-f):u<300?(t.b=i,t.g=r,t.r=r+f):u<360?(t.r=i,t.g=r,t.b=i-f):(t.r=0,t.g=0,t.b=0)}return{r:Math.round(t.r),g:Math.round(t.g),b:Math.round(t.b)}},l=function(n){var i=g(n),r=[i.r.toString(16),i.g.toString(16),i.b.toString(16)];return t.each(r,function(n,t){t.length==1&&(r[n]="0"+t)}),r.join("")},o=function(n){var t=n.match(/[0-9]{1,3}/g)||[];return{r:t[0],g:t[1],b:t[2]}},p=t(window),ut=t(document),i=function(n){var i=this;i.index=++a.index;i.config=t.extend({},i.config,a.config,n);i.render()};i.prototype.config={color:"",size:null,alpha:!1,format:"hex",predefine:!1,colors:["#009688","#5FB878","#1E9FFF","#FF5722","#FFB800","#01AAED","#999","#c00","#ff8c00","#ffd700","#90ee90","#00ced1","#1e90ff","#c71585","rgb(0, 186, 189)","rgb(255, 120, 0)","rgb(250, 212, 0)","#393D49","rgba(0,0,0,.5)","rgba(255, 69, 0, 0.68)","rgba(144, 240, 144, 0.5)","rgba(31, 147, 255, 0.73)"]};i.prototype.render=function(){var i=this,n=i.config,r=t(['<div class="layui-unselect layui-colorpicker">',"<span "+(n.format=="rgb"&&n.alpha?'class="layui-colorpicker-trigger-bgcolor"':"")+">",'<span class="layui-colorpicker-trigger-span" ','lay-type="'+(n.format=="rgb"?n.alpha?"rgba":"torgb":"")+'" ','style="'+function(){var t="";return n.color?(t=n.color,(n.color.match(/[0-9]{1,3}/g)||[]).length>3&&(n.alpha&&n.format=="rgb"||(t="#"+l(e(o(n.color))))),"background: "+t):t}()+'">','<i class="layui-icon layui-colorpicker-trigger-i '+(n.color?s:h)+'"><\/i>',"<\/span>","<\/span>","<\/div>"].join("")),f=t(n.elem);n.size&&r.addClass("layui-colorpicker-"+n.size);f.addClass("layui-inline").html(i.elemColorBox=r);i.color=i.elemColorBox.find("."+u)[0].style.background;i.events()};i.prototype.renderPicker=function(){var n=this,f=n.config,e=n.elemColorBox[0],o=n.elemPicker=t(['<div id="layui-colorpicker'+n.index+'" data-index="'+n.index+'" class="layui-anim layui-anim-upbit layui-colorpicker-main">','<div class="layui-colorpicker-main-wrapper">','<div class="layui-colorpicker-basis">','<div class="layui-colorpicker-basis-white"><\/div>','<div class="layui-colorpicker-basis-black"><\/div>','<div class="layui-colorpicker-basis-cursor"><\/div>',"<\/div>",'<div class="layui-colorpicker-side">','<div class="layui-colorpicker-side-slider"><\/div>',"<\/div>","<\/div>",'<div class="layui-colorpicker-main-alpha '+(f.alpha?tt:"")+'">','<div class="layui-colorpicker-alpha-bgcolor">','<div class="layui-colorpicker-alpha-slider"><\/div>',"<\/div>","<\/div>",function(){if(f.predefine){var n=['<div class="layui-colorpicker-main-pre">'];return layui.each(f.colors,function(t,i){n.push(['<div class="layui-colorpicker-pre'+((i.match(/[0-9]{1,3}/g)||[]).length>3?" layui-colorpicker-pre-isalpha":"")+'">','<div style="background:'+i+'"><\/div>',"<\/div>"].join(""))}),n.push("<\/div>"),n.join("")}return""}(),'<div class="layui-colorpicker-main-input">','<div class="layui-inline">','<input type="text" class="layui-input">',"<\/div>",'<div class="layui-btn-container">','<button class="layui-btn layui-btn-primary layui-btn-sm" colorpicker-events="clear">清空<\/button>','<button class="layui-btn layui-btn-sm" colorpicker-events="confirm">确定<\/button>',"<\/div","<\/div>","<\/div>"].join("")),s=n.elemColorBox.find("."+u)[0];t(r)[0]&&t(r).data("index")==n.index?n.removePicker(i.thisElemInd):(n.removePicker(i.thisElemInd),t("body").append(o));i.thisElemInd=n.index;i.thisColor=e.style.background;n.position();n.pickerEvents()};i.prototype.removePicker=function(n){var i=this,r=i.config;return t("#layui-colorpicker"+(n||i.index)).remove(),i};i.prototype.position=function(){var u=this,f=u.config,c=u.bindElem||u.elemColorBox[0],r=u.elemPicker[0],e=c.getBoundingClientRect(),h=r.offsetWidth,o=r.offsetHeight,l=function(n){return n=n?"scrollLeft":"scrollTop",document.body[n]|document.documentElement[n]},s=function(n){return document.documentElement[n?"clientWidth":"clientHeight"]},n=5,t=e.left,i=e.bottom;t=t-(h-c.offsetWidth)/2;i=i+n;t+h+n>s("width")?t=s("width")-h-n:t<n&&(t=n);i+o+n>s()&&(i=e.top>o?e.top-o:s()-o,i=i-n*2);f.position&&(r.style.position=f.position);r.style.left=t+(f.position==="fixed"?0:l(1))+"px";r.style.top=i+(f.position==="fixed"?0:l())+"px"};i.prototype.val=function(){var n=this,p=n.config,l=n.elemColorBox.find("."+u),r=n.elemPicker.find("."+f),v=l[0],i=v.style.backgroundColor,s,h,t,a;i?(s=e(o(i)),h=l.attr("lay-type"),n.select(s.h,s.s,s.b),h==="torgb"&&r.find("input").val(i),h==="rgba"&&(t=o(i),(i.match(/[0-9]{1,3}/g)||[]).length==3?(r.find("input").val("rgba("+t.r+", "+t.g+", "+t.b+", 1)"),n.elemPicker.find("."+c).css("left",280)):(r.find("input").val(i),a=i.slice(i.lastIndexOf(",")+1,i.length-1)*280,n.elemPicker.find("."+c).css("left",a)),n.elemPicker.find("."+y)[0].style.background="linear-gradient(to right, rgba("+t.r+", "+t.g+", "+t.b+", 0), rgb("+t.r+", "+t.g+", "+t.b+"))")):(n.select(0,100,100),r.find("input").val(""),n.elemPicker.find("."+y)[0].style.background="",n.elemPicker.find("."+c).css("left",280))};i.prototype.side=function(){var n=this,st=n.config,rt=n.elemColorBox.find("."+u),ht=rt.attr("lay-type"),ct=n.elemPicker.find("."+it),lt=n.elemPicker.find("."+b),ut=n.elemPicker.find("."+k),tt=n.elemPicker.find("."+d),ft=n.elemPicker.find("."+y),et=n.elemPicker.find("."+c),i=lt[0].offsetTop*2,r=100-(tt[0].offsetTop+3)/180*100,l=(tt[0].offsetLeft+3)/260*100,a=Math.round(et[0].offsetLeft/280*100)/100,at=n.elemColorBox.find("."+v),vt=n.elemPicker.find(".layui-colorpicker-pre").children("div"),w=function(t,i,r,u){var e,o;n.select(t,i,r);e=g({h:t,s:i,b:r});at.addClass(s).removeClass(h);rt[0].style.background="rgb("+e.r+", "+e.g+", "+e.b+")";ht==="torgb"&&n.elemPicker.find("."+f).find("input").val("rgb("+e.r+", "+e.g+", "+e.b+")");ht==="rgba"&&(o=0,o=u*280,et.css("left",o),n.elemPicker.find("."+f).find("input").val("rgba("+e.r+", "+e.g+", "+e.b+", "+u+")"),rt[0].style.background="rgba("+e.r+", "+e.g+", "+e.b+", "+u+")",ft[0].style.background="linear-gradient(to right, rgba("+e.r+", "+e.g+", "+e.b+", 0), rgb("+e.r+", "+e.g+", "+e.b+"))");st.change&&st.change(n.elemPicker.find("."+f).find("input").val())},nt=t('<div class="layui-auxiliar-moving" id="LAY-colorpicker-moving"><\/div'),ot=function(n){t("#LAY-colorpicker-moving")[0]||t("body").append(nt);nt.on("mousemove",n);nt.on("mouseup",function(){nt.remove()}).on("mouseleave",function(){nt.remove()})};lt.on("mousedown",function(n){var t=this.offsetTop,u=n.clientY,f=function(n){var f=t+(n.clientY-u),o=ct[0].offsetHeight,e;f<0&&(f=0);f>o&&(f=o);e=f*2;i=e;w(e,l,r,a);n.preventDefault()};ot(f);n.preventDefault()});ct.on("click",function(n){var u=n.clientY-t(this).offset().top,f;u<0&&(u=0);u>this.offsetHeight&&(u=this.offsetHeight);f=u*2;i=f;w(f,l,r,a);n.preventDefault()});tt.on("mousedown",function(n){var t=this.offsetTop,u=this.offsetLeft,f=n.clientY,e=n.clientX,o=function(n){var o=t+(n.clientY-f),s=u+(n.clientX-e),v=ut[0].offsetHeight-3,y=ut[0].offsetWidth-3,h,c;o<-3&&(o=-3);o>v&&(o=v);s<-3&&(s=-3);s>y&&(s=y);h=(s+3)/260*100;c=100-(o+3)/180*100;r=c;l=h;w(i,h,c,a);n.preventDefault()};layui.stope(n);ot(o);n.preventDefault()});ut.on("mousedown",function(n){var u=n.clientY-t(this).offset().top-3+p.scrollTop(),f=n.clientX-t(this).offset().left-3+p.scrollLeft(),e,o;u<-3&&(u=-3);u>this.offsetHeight-3&&(u=this.offsetHeight-3);f<-3&&(f=-3);f>this.offsetWidth-3&&(f=this.offsetWidth-3);e=(f+3)/260*100;o=100-(u+3)/180*100;r=o;l=e;w(i,e,o,a);n.preventDefault();tt.trigger(n,"mousedown")});et.on("mousedown",function(n){var t=this.offsetLeft,u=n.clientX,f=function(n){var f=t+(n.clientX-u),o=ft[0].offsetWidth,e;f<0&&(f=0);f>o&&(f=o);e=Math.round(f/280*100)/100;a=e;w(i,l,r,e);n.preventDefault()};ot(f);n.preventDefault()});ft.on("click",function(n){var u=n.clientX-t(this).offset().left,f;u<0&&(u=0);u>this.offsetWidth&&(u=this.offsetWidth);f=Math.round(u/280*100)/100;a=f;w(i,l,r,f);n.preventDefault()});vt.each(function(){t(this).on("click",function(){t(this).parent(".layui-colorpicker-pre").addClass("selected").siblings().removeClass("selected");var u=this.style.backgroundColor,n=e(o(u)),f=u.slice(u.lastIndexOf(",")+1,u.length-1),s;i=n.h;l=n.s;r=n.b;(u.match(/[0-9]{1,3}/g)||[]).length==3&&(f=1);a=f;s=f*280;w(n.h,n.s,n.b,f)})})};i.prototype.select=function(n,t,i,r){var u=this,a=u.config,e=l({h:n,s:100,b:100}),o=l({h:n,s:t,b:i}),s=n/2,h=177-i/100*180,c=t/100*260-3;(u.elemPicker.find("."+b).css("top",s),u.elemPicker.find("."+k)[0].style.background="#"+e,u.elemPicker.find("."+d).css({top:h,left:c}),r!=="change")&&u.elemPicker.find("."+f).find("input").val("#"+o)};i.prototype.pickerEvents=function(){var n=this,i=n.config,r=n.elemColorBox.find("."+u),y=n.elemPicker.find("."+f+" input"),a={clear:function(){r[0].style.background="";n.elemColorBox.find("."+v).removeClass(s).addClass(h);n.color="";i.done&&i.done("");n.removePicker()},confirm:function(t,u){var f=y.val(),p=f,a={},w;if(f.indexOf(",")>-1?(a=e(o(f)),n.select(a.h,a.s,a.b),r[0].style.background=p="#"+l(a),(f.match(/[0-9]{1,3}/g)||[]).length>3&&r.attr("lay-type")==="rgba"&&(w=f.slice(f.lastIndexOf(",")+1,f.length-1)*280,n.elemPicker.find("."+c).css("left",w),r[0].style.background=f,p=f)):(a=rt(f),r[0].style.background=p="#"+l(a),n.elemColorBox.find("."+v).removeClass(h).addClass(s)),u==="change"){n.select(a.h,a.s,a.b,u);i.change&&i.change(p);return}n.color=f;i.done&&i.done(f);n.removePicker()}};n.elemPicker.on("click","*[colorpicker-events]",function(){var n=t(this),i=n.attr("colorpicker-events");a[i]&&a[i].call(this,n)});y.on("keyup",function(n){var i=t(this);a.confirm.call(this,i,n.keyCode===13?null:"change")})};i.prototype.events=function(){var n=this,i=n.config,f=n.elemColorBox.find("."+u);n.elemColorBox.on("click",function(){n.renderPicker();t(r)[0]&&(n.val(),n.side())});if(i.elem[0]&&!n.elemColorBox[0].eventHandler){ut.on("click",function(i){if(!t(i.target).hasClass(w)&&!t(i.target).parents("."+w)[0]&&!t(i.target).hasClass(r.replace(/\./g,""))&&!t(i.target).parents(r)[0]&&n.elemPicker){if(n.color){var u=e(o(n.color));n.select(u.h,u.s,u.b)}else n.elemColorBox.find("."+v).removeClass(s).addClass(h);f[0].style.background=n.color||"";n.removePicker()}});p.on("resize",function(){if(!n.elemPicker||!t(r)[0])return!1;n.position()});n.elemColorBox[0].eventHandler=!0}};a.render=function(n){var t=new i(n);return nt.call(t)};n("colorpicker",a)});