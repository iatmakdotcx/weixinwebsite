/**
 @Name：layui.layedit 富文本编辑器
 @Author：贤心
 @License：MIT
    
 */
layui.define(["layer","form"],function(n){"use strict";var t=layui.$,i=layui.layer,e=layui.form,rt=layui.hint(),o=layui.device(),y="layedit",k="layui-show",c="layui-disabled",r=function(){var n=this;n.index=0;n.config={tool:["strong","italic","underline","del","|","left","center","right","|","link","unlink","face","image"],hideTool:[],height:280}};r.prototype.set=function(n){var i=this;return t.extend(!0,i.config,n),i};r.prototype.on=function(n,t){return layui.onevent(y,n,t)};r.prototype.build=function(n,i){i=i||{};var r=this,l=r.config,e="layui-layedit",u=t(typeof n=="string"?"#"+n:n),s="LAY_layedit_"+ ++r.index,h=u.next("."+e),f=t.extend({},l,i),a=function(){var n=[],t={};return layui.each(f.hideTool,function(n,i){t[i]=!0}),layui.each(f.tool,function(i,r){b[r]&&!t[r]&&n.push(b[r])}),n.join("")}(),c=t(['<div class="'+e+'">','<div class="layui-unselect layui-layedit-tool">'+a+"<\/div>",'<div class="layui-layedit-iframe">','<iframe id="'+s+'" name="'+s+'" textarea="'+n+'" frameborder="0"><\/iframe>',"<\/div>","<\/div>"].join(""));return o.ie&&o.ie<8?u.removeClass("layui-hide").addClass(k):(h[0]&&h.remove(),d.call(r,c,u[0],f),u.addClass("layui-hide").after(c),r.index)};r.prototype.getContent=function(n){var t=f(n);if(t[0])return p(t[0].document.body.innerHTML)};r.prototype.getText=function(n){var i=f(n);if(i[0])return t(i[0].document.body).text()};r.prototype.setContent=function(n,i,r){var u=f(n);u[0]&&(r?t(u[0].document.body).append(i):t(u[0].document.body).html(i),layedit.sync(n))};r.prototype.sync=function(n){var i=f(n),r;i[0]&&(r=t("#"+i[1].attr("textarea")),r.val(p(i[0].document.body.innerHTML)))};r.prototype.getSelection=function(n){var i=f(n),t;if(i[0])return t=s(i[0].document),document.selection?t.text:t.toString()};var d=function(n,i,r){var f=this,u=n.find("iframe");u.css({height:r.height}).on("load",function(){var e=u.contents(),o=u.prop("contentWindow"),s=e.find("head"),h=t("<style>*{margin: 0; padding: 0;}body{padding: 10px; line-height: 20px; overflow-x: hidden; word-wrap: break-word; font: 14px Helvetica Neue,Helvetica,PingFang SC,Microsoft YaHei,Tahoma,Arial,sans-serif; -webkit-box-sizing: border-box !important; -moz-box-sizing: border-box !important; box-sizing: border-box !important;}a{color:#01AAED; text-decoration:none;}a:hover{color:#c00}p{margin-bottom: 10px;}img{display: inline-block; border: none; vertical-align: middle;}pre{margin: 10px 0; padding: 10px; line-height: 20px; border: 1px solid #ddd; border-left-width: 6px; background-color: #F2F2F2; color: #333; font-family: Courier New; font-size: 12px;}<\/style>"),c=e.find("body");s.append(h);c.attr("contenteditable","true").css({"min-height":r.height}).html(i.value||"");g.apply(f,[o,u,i,r]);tt.call(f,o,n,r)})},f=function(n){var i=t("#LAY_layedit_"+n),r=i.prop("contentWindow");return[r,i]},p=function(n){return o.ie==8&&(n=n.replace(/<.+>/g,function(n){return n.toLowerCase()})),n},g=function(n,r,u){var e=n.document,f=t(e.body);f.on("keydown",function(n){var t=n.keyCode;if(t===13){var r=s(e),u=l(r),f=u.parentNode;if(f.tagName.toLowerCase()==="pre")return n.shiftKey?void 0:(i.msg("请暂时用shift+enter"),!1);e.execCommand("formatBlock",!1,"<p>")}});t(u).parents("form").on("submit",function(){var n=f.html();o.ie==8&&(n=n.replace(/<.+>/g,function(n){return n.toLowerCase()}));u.value=n});f.on("paste",function(){e.execCommand("formatBlock",!1,"<p>");setTimeout(function(){nt.call(n,f);u.value=f.html()},100)})},nt=function(n){var i=this,r=i.document;n.find("*[style]").each(function(){var n=this.style.textAlign;this.removeAttribute("style");t(this).css({"text-align":n||""})});n.find("table").addClass("layui-table");n.find("script,link").remove()},s=function(n){return n.selection?n.selection.createRange():n.getSelection().getRangeAt(0)},l=function(n){return n.endContainer||n.parentElement().childNodes[0]},h=function(n,i,r){var o=this.document,f=document.createElement(n),e,u;for(e in i)f.setAttribute(e,i[e]);if(f.removeAttribute("text"),o.selection){if(u=r.text||i.text,n==="a"&&!u)return;u&&(f.innerHTML=u);r.pasteHTML(t(f).prop("outerHTML"));r.select()}else{if(u=r.toString()||i.text,n==="a"&&!u)return;u&&(f.innerHTML=u);r.deleteContents();r.insertNode(f)}},w=function(n,i){var f=this.document,r="layedit-tool-active",e=l(s(f)),u=function(t){return n.find(".layedit-tool-"+t)};i&&i[i.hasClass(r)?"removeClass":"addClass"](r);n.find(">i").removeClass(r);u("unlink").addClass(c);t(e).parents().each(function(){var n=this.tagName.toLowerCase(),t=this.style.textAlign;(n==="b"||n==="strong")&&u("b").addClass(r);(n==="i"||n==="em")&&u("i").addClass(r);n==="u"&&u("u").addClass(r);n==="strike"&&u("d").addClass(r);n==="p"&&(t==="center"?u("center").addClass(r):t==="right"?u("right").addClass(r):u("left").addClass(r));n==="a"&&(u("link").addClass(r),u("unlink").removeClass(c))})},tt=function(n,r,f){var e=n.document,o=t(e.body),p={link:function(i){var u=l(i),r=t(u).parent();a.call(o,{href:r.attr("href"),target:r.attr("target")},function(t){var u=r[0];u.tagName==="A"?u.href=t.url:h.call(n,"a",{target:t.target,href:t.url,text:t.url},i)})},unlink:function(){e.execCommand("unlink")},face:function(t){u.call(this,function(i){h.call(n,"img",{src:i.src,alt:i.alt},t)})},image:function(r){var u=this;layui.use("upload",function(e){var o=f.uploadImage||{};e.render({url:o.url,method:o.type,elem:t(u).find("input")[0],done:function(t){t.code==0?(t.data=t.data||{},h.call(n,"img",{src:t.data.src,alt:t.data.title},r)):i.msg(t.msg||"上传失败")}})})},code:function(t){v.call(o,function(i){h.call(n,"pre",{text:i.code,"lay-lang":i.lang},t)})},help:function(){i.open({type:2,title:"帮助",area:["600px","380px"],shadeClose:!0,shade:.1,skin:"layui-layer-msg",content:["http://www.layui.com/about/layedit/help.html","no"]})}},y=r.find(".layui-layedit-tool"),b=function(){var i=t(this),f=i.attr("layedit-event"),r=i.attr("lay-command"),u,h;i.hasClass(c)||(o.focus(),u=s(e),h=u.commonAncestorContainer,r?(e.execCommand(r),/justifyLeft|justifyCenter|justifyRight/.test(r)&&e.execCommand("formatBlock",!1,"<p>"),setTimeout(function(){o.focus()},10)):p[f]&&p[f].call(this,u),w.call(n,y,i))},k=/image/;y.find(">i").on("mousedown",function(){var n=t(this),i=n.attr("layedit-event");k.test(i)||b.call(this)}).on("click",function(){var n=t(this),i=n.attr("layedit-event");k.test(i)&&b.call(this)});o.on("click",function(){w.call(n,y);i.close(u.index)})},a=function(n,t){var r=this,u=i.open({type:1,id:"LAY_layedit_link",area:"350px",shade:.05,shadeClose:!0,moveType:1,title:"超链接",skin:"layui-layer-msg",content:['<ul class="layui-form" style="margin: 15px;">','<li class="layui-form-item">','<label class="layui-form-label" style="width: 60px;">URL<\/label>','<div class="layui-input-block" style="margin-left: 90px">','<input name="url" lay-verify="url" value="'+(n.href||"")+'" autofocus="true" autocomplete="off" class="layui-input">',"<\/div>","<\/li>",'<li class="layui-form-item">','<label class="layui-form-label" style="width: 60px;">打开方式<\/label>','<div class="layui-input-block" style="margin-left: 90px">','<input type="radio" name="target" value="_self" class="layui-input" title="当前窗口"'+(n.target==="_self"||!n.target?"checked":"")+">",'<input type="radio" name="target" value="_blank" class="layui-input" title="新窗口" '+(n.target==="_blank"?"checked":"")+">","<\/div>","<\/li>",'<li class="layui-form-item" style="text-align: center;">','<button type="button" lay-submit lay-filter="layedit-link-yes" class="layui-btn"> 确定 <\/button>','<button style="margin-left: 20px;" type="button" class="layui-btn layui-btn-primary"> 取消 <\/button>',"<\/li>","<\/ul>"].join(""),success:function(n,u){e.render("radio");n.find(".layui-btn-primary").on("click",function(){i.close(u);r.focus()});e.on("submit(layedit-link-yes)",function(n){i.close(a.index);t&&t(n.field)})}});a.index=u},u=function(n){var r=function(){var n={};return layui.each(["[微笑]","[嘻嘻]","[哈哈]","[可爱]","[可怜]","[挖鼻]","[吃惊]","[害羞]","[挤眼]","[闭嘴]","[鄙视]","[爱你]","[泪]","[偷笑]","[亲亲]","[生病]","[太开心]","[白眼]","[右哼哼]","[左哼哼]","[嘘]","[衰]","[委屈]","[吐]","[哈欠]","[抱抱]","[怒]","[疑问]","[馋嘴]","[拜拜]","[思考]","[汗]","[困]","[睡]","[钱]","[失望]","[酷]","[色]","[哼]","[鼓掌]","[晕]","[悲伤]","[抓狂]","[黑线]","[阴险]","[怒骂]","[互粉]","[心]","[伤心]","[猪头]","[熊猫]","[兔子]","[ok]","[耶]","[good]","[NO]","[赞]","[来]","[弱]","[草泥马]","[神马]","[囧]","[浮云]","[给力]","[围观]","[威武]","[奥特曼]","[礼物]","[钟]","[话筒]","[蜡烛]","[蛋糕]"],function(t,i){n[i]=layui.cache.dir+"images/face/"+t+".gif"}),n}();return u.hide=u.hide||function(n){t(n.target).attr("layedit-event")!=="face"&&i.close(u.index)},u.index=i.tips(function(){var n=[];return layui.each(r,function(t,i){n.push('<li title="'+t+'"><img src="'+i+'" alt="'+t+'"><\/li>')}),'<ul class="layui-clear">'+n.join("")+"<\/ul>"}(),this,{tips:1,time:0,skin:"layui-box layui-util-face",maxWidth:500,success:function(f,e){f.css({marginTop:-4,marginLeft:-10}).find(".layui-clear>li").on("click",function(){n&&n({src:r[this.title],alt:this.title});i.close(e)});t(document).off("click",u.hide).on("click",u.hide)}})},v=function(n){var t=this,r=i.open({type:1,id:"LAY_layedit_code",area:"550px",shade:.05,shadeClose:!0,moveType:1,title:"插入代码",skin:"layui-layer-msg",content:'<ul class="layui-form layui-form-pane" style="margin: 15px;"><li class="layui-form-item"><label class="layui-form-label">请选择语言<\/label><div class="layui-input-block"><select name="lang"><option value="JavaScript">JavaScript<\/option><option value="HTML">HTML<\/option><option value="CSS">CSS<\/option><option value="Java">Java<\/option><option value="PHP">PHP<\/option><option value="C#">C#<\/option><option value="Python">Python<\/option><option value="Ruby">Ruby<\/option><option value="Go">Go<\/option><\/select><\/div><\/li><li class="layui-form-item layui-form-text"><label class="layui-form-label">代码<\/label><div class="layui-input-block"><textarea name="code" lay-verify="required" autofocus="true" class="layui-textarea" style="height: 200px;"><\/textarea><\/div><\/li><li class="layui-form-item" style="text-align: center;"><button type="button" lay-submit lay-filter="layedit-code-yes" class="layui-btn"> 确定 <\/button><button style="margin-left: 20px;" type="button" class="layui-btn layui-btn-primary"> 取消 <\/button><\/li><\/ul>',success:function(r,u){e.render("select");r.find(".layui-btn-primary").on("click",function(){i.close(u);t.focus()});e.on("submit(layedit-code-yes)",function(t){i.close(v.index);n&&n(t.field)})}});v.index=r},b={html:'<i class="layui-icon layedit-tool-html" title="HTML源代码" lay-command="html" layedit-event="html"">&#xe64b;<\/i><span class="layedit-tool-mid"><\/span>',strong:'<i class="layui-icon layedit-tool-b" title="加粗" lay-command="Bold" layedit-event="b"">&#xe62b;<\/i>',italic:'<i class="layui-icon layedit-tool-i" title="斜体" lay-command="italic" layedit-event="i"">&#xe644;<\/i>',underline:'<i class="layui-icon layedit-tool-u" title="下划线" lay-command="underline" layedit-event="u"">&#xe646;<\/i>',del:'<i class="layui-icon layedit-tool-d" title="删除线" lay-command="strikeThrough" layedit-event="d"">&#xe64f;<\/i>',"|":'<span class="layedit-tool-mid"><\/span>',left:'<i class="layui-icon layedit-tool-left" title="左对齐" lay-command="justifyLeft" layedit-event="left"">&#xe649;<\/i>',center:'<i class="layui-icon layedit-tool-center" title="居中对齐" lay-command="justifyCenter" layedit-event="center"">&#xe647;<\/i>',right:'<i class="layui-icon layedit-tool-right" title="右对齐" lay-command="justifyRight" layedit-event="right"">&#xe648;<\/i>',link:'<i class="layui-icon layedit-tool-link" title="插入链接" layedit-event="link"">&#xe64c;<\/i>',unlink:'<i class="layui-icon layedit-tool-unlink layui-disabled" title="清除链接" lay-command="unlink" layedit-event="unlink"">&#xe64d;<\/i>',face:'<i class="layui-icon layedit-tool-face" title="表情" layedit-event="face"">&#xe650;<\/i>',image:'<i class="layui-icon layedit-tool-image" title="图片" layedit-event="image">&#xe64a;<input type="file" name="file"><\/i>',code:'<i class="layui-icon layedit-tool-code" title="插入代码" layedit-event="code">&#xe64e;<\/i>',help:'<i class="layui-icon layedit-tool-help" title="帮助" layedit-event="help">&#xe607;<\/i>'},it=new r;n(y,it)});